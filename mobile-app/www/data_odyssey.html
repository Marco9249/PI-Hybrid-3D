<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PI-Hybrid: Data Odyssey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;700;900&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #030308;
            --cyan: #00f2ff;
            --purple: #7000ff;
            --red: #ff0055;
            --green: #00ff88;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: #fff;
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }

        /* Terminal Sidebar (Raw Data) */
        #terminal {
            position: fixed;
            left: 0;
            top: 0;
            width: 350px;
            height: 100vh;
            background: rgba(10, 10, 15, 0.95);
            border-right: 1px solid rgba(0, 242, 255, 0.2);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            padding: 20px;
            overflow: hidden;
            z-index: 100;
        }

        .terminal-header {
            color: var(--cyan);
            border-bottom: 1px solid var(--cyan);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }

        .log-entry {
            margin-bottom: 5px;
            opacity: 0.7;
        }

        .log-error {
            color: var(--red);
        }

        .log-success {
            color: var(--green);
        }

        .log-warn {
            color: #ffcc00;
        }

        /* Main Content Area */
        #main-stage {
            margin-left: 350px;
            padding: 50px;
            min-height: 100vh;
            position: relative;
        }

        h1 {
            font-size: 4rem;
            background: linear-gradient(90deg, #fff, var(--cyan));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .section-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 50px;
            position: relative;
            overflow: hidden;
        }

        /* Cleaning Canvas */
        #cleaningCanvas {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        button {
            background: transparent;
            border: 1px solid var(--cyan);
            color: var(--cyan);
            padding: 10px 20px;
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: var(--cyan);
            color: #000;
        }

        button.active {
            background: var(--cyan);
            color: #000;
            box-shadow: 0 0 15px var(--cyan);
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-box {
            background: rgba(0, 242, 255, 0.05);
            border: 1px solid rgba(0, 242, 255, 0.1);
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .feature-box:hover {
            transform: translateY(-5px);
            border-color: var(--cyan);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        /* Navigation */
        .nav-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            background: var(--purple);
            color: white;
            text-decoration: none;
            font-weight: bold;
            border-radius: 30px;
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.5);
            transition: transform 0.3s;
        }

        .nav-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>

<body>

    <!-- Terminal Sidebar -->
    <div id="terminal">
        <div class="terminal-header">
            <span>NASA POWER API :: STREAM</span>
            <span class="status-indicator">‚óè LIVE</span>
        </div>
        <div id="log-container"></div>
    </div>

    <!-- Main Content -->
    <div id="main-stage">

        <!-- Header -->
        <header>
            <div style="font-family:'Space Mono'; color:var(--purple); margin-bottom:10px;">PHASE 01 // DATA ENGINEERING
            </div>
            <h1>The Data Odyssey</h1>
            <p style="font-size:1.2rem; max-width:800px; color:rgba(255,255,255,0.7);">
                Raw satellite data is chaotic. Before the neural network sees a single pixel, we must rigorously clean,
                filter, and
                inject physical laws into the stream.
            </p>
        </header>

        <br><br>

        <!-- Section 1: The Cleaning Protocol -->
        <div class="section-card">
            <h2>01. The Cleaning Protocol</h2>
            <p style="margin-bottom:20px; font-family:'Space Mono'; color:rgba(255,255,255,0.5);">
                INTERACTIVE PIPELINE: Detect Gaps -> Interpolate -> Night Mask
            </p>

            <canvas id="cleaningCanvas"></canvas>

            <div class="controls">
                <button id="btn-raw" class="active">RAW DATA</button>
                <button id="btn-interp">STEP 1: INTERPOLATE</button>
                <button id="btn-mask">STEP 2: PHYSICS MASK</button>
            </div>
        </div>

        <!-- Section 2: Physics Injection -->
        <div class="section-card">
            <h2>02. Physics Injection (Feature Engineering)</h2>
            <p>We don't just feed raw data. We engineer <strong>15 Deterministic Features</strong> based on Solar
                Geometry.</p>

            <div class="feature-grid">
                <!-- Physical Features -->
                <div class="feature-box">
                    <span class="feature-icon">‚òÄÔ∏è</span>
                    <div style="font-size:0.8rem; color:var(--cyan);">PHYSICS</div>
                    <strong>Clear Sky GHI</strong>
                    <div style="font-size:0.7rem; opacity:0.6;">Theoretical max</div>
                </div>
                <div class="feature-box">
                    <span class="feature-icon">üìê</span>
                    <div style="font-size:0.8rem; color:var(--cyan);">GEOMETRY</div>
                    <strong>Zenith Angle</strong>
                    <div style="font-size:0.7rem; opacity:0.6;">Solar Position</div>
                </div>
                <div class="feature-box">
                    <span class="feature-icon">‚òÅÔ∏è</span>
                    <div style="font-size:0.8rem; color:var(--cyan);">DERIVED</div>
                    <strong>Clearness Index</strong>
                    <div style="font-size:0.7rem; opacity:0.6;">Atmospheric Trans.</div>
                </div>
                <div class="feature-box">
                    <span class="feature-icon">üìâ</span>
                    <div style="font-size:0.8rem; color:var(--cyan);">STATISTICAL</div>
                    <strong>Volatility</strong>
                    <div style="font-size:0.7rem; opacity:0.6;">Rolling StdDev</div>
                </div>

                <!-- Raw Features -->
                <div class="feature-box" style="border-color:rgba(255,255,255,0.1);">
                    <span class="feature-icon">üì°</span>
                    <div style="font-size:0.8rem; color:var(--purple);">SATELLITE</div>
                    <strong>GHI Raw</strong>
                </div>
                <div class="feature-box" style="border-color:rgba(255,255,255,0.1);">
                    <span class="feature-icon">üíß</span>
                    <div style="font-size:0.8rem; color:var(--purple);">SENSOR</div>
                    <strong>Dew Point</strong>
                </div>

                <!-- Temporal Features -->
                <div class="feature-box" style="border-color:var(--green);">
                    <span class="feature-icon">üïí</span>
                    <div style="font-size:0.8rem; color:var(--green);">TEMPORAL</div>
                    <strong>Hour (Sin/Cos)</strong>
                </div>
                <div class="feature-box" style="border-color:var(--green);">
                    <span class="feature-icon">üìÖ</span>
                    <div style="font-size:0.8rem; color:var(--green);">TEMPORAL</div>
                    <strong>Day (Sin/Cos)</strong>
                </div>

            </div>
        </div>

    </div>

    <a href="index.html" class="nav-btn">BACK TO HUB</a>

    <script>
        // --- TERMINAL LOGIC ---
        const logContainer = document.getElementById('log-container');
        const logs = [
            { text: "Initializing NASA POWER link...", type: "normal" },
            { text: "Connection established: Omdurman (14.7¬∞N, 33.2¬∞E)", type: "success" },
            { text: "Fetching parameters: GHI, DNI, DHI, T2M...", type: "normal" },
            { text: "WARNING: Null value detected at 2023-06-12 14:00", type: "warn" },
            { text: "ERROR: GHI -999 at 2023-06-12 15:00", type: "error" },
            { text: "Interpolating missing frame...", type: "success" },
            { text: "Calculating Solar Zenith Angle...", type: "normal" },
            { text: "Deriving Clearness Index (Kt)...", type: "normal" },
            { text: "Applying Night Mask (Elevation < 0)...", type: "success" },
            { text: "Feature Vector Constructed [15x24]", type: "success" }
        ];

        let logIndex = 0;
        function addLog() {
            if (logIndex >= logs.length) logIndex = 0;
            const entry = logs[logIndex];
            const div = document.createElement('div');
            div.className = `log-entry log-${entry.type}`;
            div.innerHTML = `<span style="color:#666">[${new Date().toLocaleTimeString()}]</span> ${entry.text}`;
            logContainer.prepend(div);
            if (logContainer.children.length > 20) logContainer.lastChild.remove();

            logIndex++;
            setTimeout(addLog, Math.random() * 1000 + 500);
        }
        addLog();

        // --- CLEANING VISUALIZATION ---
        const canvas = document.getElementById('cleaningCanvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        function resize() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 400;
            width = canvas.width;
            height = canvas.height;
        }
        window.addEventListener('resize', resize);
        resize();

        // Generate synthetic data
        const points = 100;
        const data = [];
        for (let i = 0; i < points; i++) {
            // Solar Curve (Sine wave) + Noise
            let val = Math.sin(i * 0.1) * 100;
            if (val < 0) val = Math.random() * 20 - 10; // Night noise
            else val += (Math.random() - 0.5) * 30; // Day noise

            // Add artificial gaps
            if (i > 30 && i < 40) val = null;
            if (i > 70 && i < 75) val = -999; // Error code

            data.push({ x: i, raw: val, clean: 0 });
        }

        let mode = 'raw'; // raw, interp, mask

        // Animation Loop
        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Draw Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.beginPath();
            for (let i = 0; i < width; i += 50) { ctx.moveTo(i, 0); ctx.lineTo(i, height); }
            ctx.stroke();

            // Solar Elevation Baseline (for reference in Mask mode)
            if (mode === 'mask') {
                ctx.strokeStyle = 'rgba(0, 242, 255, 0.2)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                for (let i = 0; i < points; i++) {
                    const x = (i / points) * width;
                    const y = height / 2 - Math.sin(i * 0.1) * 150;
                    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = 'rgba(0, 242, 255, 0.5)';
                ctx.fillText("THEORETICAL CLEAR SKY LIMIT", 10, 20);
            }

            // Draw Data Line
            ctx.lineWidth = 3;
            ctx.beginPath();

            let lastValidX = 0;
            let lastValidY = 0;

            for (let i = 0; i < points; i++) {
                const x = (i / points) * width;
                let val = data[i].raw;

                // LOGIC PIPELINE
                if (mode === 'interp' || mode === 'mask') {
                    // Fix Gaps & Errors
                    if (val === null || val === -999) {
                        // Simple visual interpolation logic
                        val = Math.sin(i * 0.1) * 100;
                        if (val < 0) val = 0;
                    }
                }

                if (mode === 'mask') {
                    // Physics Mask: If theoretical < 0, val = 0
                    const theoretical = Math.sin(i * 0.1);
                    if (theoretical < 0) val = 0;
                }

                // Map to finish
                const y = height / 2 - val;

                // Draw Logic
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    // Gap handling for Raw mode
                    if (mode === 'raw' && (val === null || val === -999)) {
                        ctx.strokeStyle = '#ff0055'; // Red for error
                        ctx.stroke();
                        ctx.beginPath(); // Break line
                        continue;
                    }
                    ctx.strokeStyle = (mode === 'raw') ? '#ff0055' : (mode === 'mask' ? '#00f2ff' : '#ffcc00');
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            requestAnimationFrame(draw);
        }
        draw();

        // Controls
        document.getElementById('btn-raw').onclick = () => { mode = 'raw'; updateBtns('btn-raw'); };
        document.getElementById('btn-interp').onclick = () => { mode = 'interp'; updateBtns('btn-interp'); };
        document.getElementById('btn-mask').onclick = () => { mode = 'mask'; updateBtns('btn-mask'); };

        function updateBtns(id) {
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

    </script>
</body>

</html>